---
title: "Multi-step Tool Use (Agents)"
slug: "docs/multi-step-tool-use"
hidden: false 
description: "Tool use allows developers to connect Cohere's models to external tools for various actions, while multi-step tool use extends this to allow the model to call multiple tools in a sequence of steps. This process enables the model to reason, perform dynamic actions, and adapt quickly based on external information."
image: "../../../../assets/images/21a3b59-cohere_meta_image.jpg"
createdAt: "Wed Mar 27 2024 19:22:07 GMT+0000 (Coordinated Universal Time)"
updatedAt: "Mon Jun 17 2024 19:41:53 GMT+0000 (Coordinated Universal Time)"
---
Tool use is a technique which allows Cohere's models to invoke external tools: search engines, APIs, functions, databases, and so on. Given a list of tool definitions, the model will generate a plan of action and decide which tools to use, in which order, and with what parameters.

For example, given the `web-search` tool, the model can start answering complex questions that require performing internet searches.

![](../../../../assets/images/00e8907-image.png)
Notice that the model learned information from the first search, which it then used to perform a second web search. This behavior is called "multi-step" because the model tackles the task step by step.

Also, note that multi-step is enabled by default.

## Using the Chat API with Tools

### Step 1: Define the tools

```python PYTHON
# define the `web_search` tool.

def web_search(query: str) -> list[dict]:
  # your code for performing a web search goes here
  # return [{
  #		"url": "https://en.wikipedia.org/wiki/Ontario",
  #		"text": "The capital of Ontario is Toronto, ..."
  #	}]

web_search_tool = {
    "type": "function",
    "function": {
        "name": "web_search",
        "description": "performs a web search with the specified query",
        "parameters": {
            "type": "object",
            "properties": {
                "query": {
                    "type": "str",
                    "description": "the query to look up"
                }
            },
            "required": ["query"]
        }
    }
}
```

### Step 2: Ask model for tool calls and send back tool results

```python PYTHON
import cohere
co = cohere.ClientV2(api_key="<YOUR API KEY>")

# 1 - Add the user message
message = "Who is the mayor of the capital of Ontario?"
messages = [{'role': 'user', 'content': message}]

# 2 - Model generates tool calls, if any
model = "command-r-plus"
res = co.chat(model=model,
              messages=messages,
              tools=[web_search_tool])

# As long as the model sends back tool_calls,
# keep invoking tools and sending the results back to the model
while res.message.tool_calls:
    print("\nTool plan:")
    print(res.message.tool_plan) # This will be an observation and a plan with next steps
    
    print("\nTool calls:")
    for tc in res.message.tool_calls:
        print(f"Tool name: {tc.function.name} | Parameters: {tc.function.arguments}")
    
    messages.append({'role': 'assistant',
                      'tool_calls': res.message.tool_calls,
                      'tool_plan': res.message.tool_plan})
    
    # 3 - Execute tools based on the tool calls generated by the model
    print("\nTool results:")
    for tc in res.message.tool_calls:
        tool_result = web_search(**json.loads(tc.function.arguments))
        print(tool_result)
        tool_content = [cohere.ToolContent(output=tool_result)]
        messages.append({'role': 'tool',
                         'tool_call_id': tc.id,
                         'tool_content': tool_content}) 

    # 4 - Model either generates more tool calls or returns a response
    res = co.chat(model=model,
                messages=messages,
                tools=[web_search_tool])

print("\nResponse:")
print(res.message.content[0].text) # "The mayor of Toronto, the capital of Ontario is Olivia Chow"

if res.message.citations:
    print("\nCitations:")
    for citation in res.message.citations:
        print(citation, "\n")
```
```
# EXAMPLE RESPONSE

Tool plan:
First I will search for the capital of Ontario, then I will search for the mayor of that city.

Tool calls:
Tool name: web_search | Parameters: {"query":"capital of Ontario"}

Tool results:
{'documents': [{'title': 'Ontario', 'snippet': "It is home to the nation's capital, Ottawa, and its most populous city, Toronto, which is Ontario's provincial capital. Ontario. Province · A red flag ...", 'url': 'https://en.wikipedia.org/wiki/Ontario'}]}

Tool plan:
I now know that Toronto is the capital of Ontario. I need to search for the mayor of Toronto.

Tool calls:
Tool name: web_search | Parameters: {"query":"mayor of toronto"}

Tool results:
{'documents': [{'title': 'Mayor of Toronto', 'snippet': 'Olivia Chow has served as the 66th and current mayor of Toronto since July 12, 2023, after winning the 2023 by-election.', 'url': 'https://en.wikipedia.org/wiki/Mayor_of_Toronto'}]}

Response:
Toronto is the capital of Ontario, and Olivia Chow is the current mayor.

Citations:
start=0 end=7 text='Toronto' sources=[Source_Tool(id='web_search_vzj0at1aj4h6:0', tool_output={'documents': '[{"snippet":"It is home to the nation\'s capital, Ottawa, and its most populous city, Toronto, which is Ontario\'s provincial capital. Ontario. Province · A red flag ...","title":"Ontario","url":"https://en.wikipedia.org/wiki/Ontario"}]'}, type='tool')] 

start=39 end=50 text='Olivia Chow' sources=[Source_Tool(id='web_search_nk68kpe77jq8:0', tool_output={'documents': '[{"snippet":"Olivia Chow has served as the 66th and current mayor of Toronto since July 12, 2023, after winning the 2023 by-election.","title":"Mayor of Toronto","url":"https://en.wikipedia.org/wiki/Mayor_of_Toronto"}]'}, type='tool')] 

```

## How Does Multi-step Tool Use Work?

<Frame caption={<a href="https://python.langchain.com/docs/use_cases/tool_use">Source</a>}>
<img src="../../../../assets/images/1e500e0-tool_use_1.svg" />
</Frame>

Here’s an outline of the basic steps involved in multi-step tool use:

- Given a user request, the model comes up with a plan to solve the problem which answers questions such as "Which tools should be used," and "In what order should they be used."
- The model then carries out the plan by repeatedly executing actions (using whatever tools are appropriate), reasoning over the results, and re-evaluating the plan.
- After each Action -> Observation ->Reflection cycle, the model reflects about what to do next. This reflection involves analyzing what has been figured out so far, determining whether any changes need to be made to the plan, and what to do next. The model can take as many steps as it deems necessary.
- Once the model decides it knows how to answer the user question, it proceeds to generating the final response.

#### What is the difference between tool use and Retrieval Augmented Generation (RAG)?

Tool use is a natural extension of retrieval augmented generation (RAG). RAG is about enabling the model to interact with an information retrieval system (like a vector database). Our models are trained to be excellent at RAG use cases.

Tool use pushes this further, allowing Cohere models to go far beyond information retrieval, interact with search engines, APIs, functions, databases, and many other tools.